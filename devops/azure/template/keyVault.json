{
	"$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"KeyVaultName": {
			"type": "string",
			"metadata": {
				"description": "Name of the Vault"
			}
		},
		"clientObjectId": {
			"type": "string",
			"metadata": {
				"description": "Object Id of the AD user."
			}
		},
		"supervisorObjectId": {
			"type": "string",
			"metadata": {
				"description": "Object Id of the AD user. Get using Get-AzureRmADUser or Get-AzureRmADServicePrincipal cmdlets"
			}
		},
		"skuName": {
			"type": "string",
			"defaultValue": "Standard",
			"allowedValues": [
				"Standard",
				"Premium"
			],
			"metadata": {
				"description": "SKU for the vault"
			}
		},
		"enableVaultForDeployment": {
			"type": "bool",
			"defaultValue": false,
			"allowedValues": [
				true,
				false
			],
			"metadata": {
				"description": "Specifies if the vault is enabled for a VM deployment"
			}
		},
		"enableVaultForDiskEncryption": {
			"type": "bool",
			"defaultValue": false,
			"allowedValues": [
				true,
				false
			],
			"metadata": {
				"description": "Specifies if the azure platform has access to the vault for enabling disk encryption scenarios."
			}
		},
		"enabledForTemplateDeployment": {
			"type": "bool",
			"defaultValue": true,
			"allowedValues": [
				true,
				false
			],
			"metadata": {
				"description": "Specifies whether Azure Resource Manager is permitted to retrieve secrets from the key vault."
			}
		}
	},
	"variables": {
		"apiVersion": "2016-10-01",
		"location": "[resourceGroup().location]",
	},
	"resources": [{
			"type": "Microsoft.KeyVault/vaults",
			"name": "[parameters('KeyVaultName')]",
			"apiVersion": "[variables('apiVersion')]",
			"location": "[variables('location')]",
			"properties": {
				"sku": {
					"name": "[parameters('skuName')]",
					"family": "A"
				},
				"tenantId": "[subscription().tenantId]",
				"accessPolicies": [{
						"tenantId": "[subscription().tenantId]",
						"objectId": "[parameters('clientObjectId')]",
						"permissions": {
							"secrets": ["Get"]
						}
					}, {
						"tenantId": "[subscription().tenantId]",
						"objectId": "[parameters('supervisorObjectId')]",
						"permissions": {
							"keys": ["All"],
							"secrets": ["All"],
							"certificates": ["All"]
						}
					}
				],
				"enabledForDeployment": "[parameters('enableVaultForDeployment')]",
				"enabledForTemplateDeployment": "[parameters('enabledForTemplateDeployment')]",
				"enabledForDiskEncryption": "[parameters('enableVaultForDiskEncryption')]"
			}
		}
	],
	"outputs": {
		"vaultBaseUrl": {
			"type": "string",
			"value": "[concat('https://', parameters('KeyVaultName'), '.vault.azure.net/')]"
		}
	}
}