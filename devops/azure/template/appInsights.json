{
        "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
        "contentVersion": "1.0.0.0",
        "parameters": {
            "AppInsightName": {
                "type": "string",
                "metadata": {
                    "description": "Enter the application name."
                }
            },
            "AppInsightType": {
                "type": "string",
                "defaultValue": "web",
                "allowedValues": [
                    "web",
                    "java",
                    "HockeyAppBridge",
                    "other"
                ],
                "metadata": {
                    "description": "Enter the application type."
                }
            },
            "PriceCode": {
                "type": "int",
                "defaultValue": 1,
                "allowedValues": [
                    1,
                    2
                ],
                "metadata": {
                    "description": "1 = Basic, 2 = Enterprise"
                }
            },
            "DailyQuota": {
                "type": "int",
                "defaultValue": 100,
                "minValue": 1,
                "metadata": {
                    "description": "Enter daily quota in GB."
                }
            },
            "DailyQuotaResetTime": {
                "type": "int",
                "defaultValue": 24,
                "metadata": {
                    "description": "Enter daily quota reset hour in UTC (0 to 23). Values outside the range will get a random reset hour."
                }
            },
            "WarningThreshold": {
                "type": "int",
                "defaultValue": 90,
                "minValue": 1,
                "maxValue": 100,
                "metadata": {
                    "description": "Enter the % value of daily quota after which warning mail to be sent. "
                }
            }
        },
        "variables": {
			"apiVersion": "2015-05-01", 
			"location": "[resourceGroup().location]",
            "priceArray": [
                "Basic",
                "Application Insights Enterprise"
            ],
            "pricePlan": "[take(variables('priceArray'),parameters('PriceCode'))]",
            "billingplan": "[concat(parameters('AppInsightName'),'/', variables('pricePlan')[0])]"
        },
        "resources": [
            {
                "type": "microsoft.insights/components",
                "kind": "[parameters('AppInsightType')]",
                "name": "[parameters('AppInsightName')]",
                "apiVersion":"[variables('apiVersion')]",
                "location": "[variables('location')]",
                "tags": {},
                "properties": {
                    "ApplicationId": "[parameters('AppInsightName')]"
                },
                "dependsOn": []
            },
            {
                "name": "[variables('billingplan')]",
                "type": "microsoft.insights/components/CurrentBillingFeatures",
                "location": "[variables('location')]",
                "apiVersion":"[variables('apiVersion')]",
                "dependsOn": [
                    "[resourceId('microsoft.insights/components', parameters('AppInsightName'))]"
                ],
                "properties": {
                    "CurrentBillingFeatures": "[variables('pricePlan')]",
                    "DataVolumeCap": {
                        "Cap": "[parameters('DailyQuota')]",
                        "WarningThreshold": "[parameters('WarningThreshold')]",
                        "ResetTime": "[parameters('DailyQuotaResetTime')]"
                    }
                }
            }
        ],
		"outputs": {
			"instrumentationKey": {
				"value": "[reference(resourceId('Microsoft.Insights/components', parameters('AppInsightName')), variables('apiVersion')).InstrumentationKey]",
				"type": "string"
			}
		}
}